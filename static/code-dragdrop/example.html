<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Code Ordering Example</title>
  <link rel="stylesheet" href="../css/jquery-ui-sortable.min.css">
  <script src="../js/vendor/jquery.js"></script>
  <script src="../js/jquery-ui-sortable.min.js"></script>
  <script src="../js/processing.min.js"></script>
  <style>
      #sortable { list-style-type: none; margin: 0; padding: 0; width: 60%; }
      #sortable li { margin: 0 3px 3px 3px; padding: 0.4em; padding-left: 1.5em; font-size: 1.4em; height: 18px; }
      #sortable li div { display: inline-block; }
      #sortable li .ui-icon { position: absolute; margin-left: -1.3em; }
  </style>

  <script>
    $.fn.randomize = function(selector){
        (selector ? this.find(selector) : this).parent().each(function(){
            $(this).children(selector).sort(function(){
                return Math.random() - 0.5;
            }).detach().appendTo(this);
        });

        return this;
    };
    function populateList(selector, strings) {

        var $ul = $(selector);  // better be a ul
        var count = strings.length;
        for (var i = 0; i < count; i++) {

            var $li = $('<li>', {'class': 'ui-state-default'});
            $li.append($('<div>', {'class': 'ui-icon ui-icon-arrow-thick-2-n-s'}),
                       $('<div>', {'class': 'code', 'text': strings[i]}));
            $ul.append($li);
        }

        // Randomize the order of the list items
        $ul.randomize('li');
    }
  </script>

  <script>
  $(document).ready(function() {

    var code_order = [
        'fill(255, 0, 0);', 
        'rect(10, 10, 40, 35);', 
        'rect(15, 15, 20, 60);',
        'rect(20, 20, 40, 35);',
        'rect(70, 25, 10, 10);',
        'rect(10, 10, 40, 35);'
    ];

    populateList('#sortable', code_order);

    $( "#sortable" ).sortable();
    $( "#sortable" ).disableSelection();

    var $runningJs = $('#running');
    var $error = $('#error');
    $('#reload').on('click', function() {
        // Remove the exisiting canvas
        var canvasId = $runningJs.attr('data-processing-target');
        $('#'+canvasId).replaceWith($('<canvas>', {'id': canvasId}));

        // Clear any previous errors
        $error.html('');

        // Collect the code text from the ul
        var code = '';
        $('#sortable li').each(function(idx, item) {
            code = code + "\n" + $(item).text();
        });

        $runningJs.html(code);

        try {
            Processing.reload();
        } catch(e) {
            $error.html(e.message);
        }
    });

  });
  </script>
</head>
<body>

<p>Drag the following lines of code into the correct order to create this image:
<br />
<img src="target.png" alt="target image" width="107" height="110" />
</p>
 
<ul id="sortable"></ul>

<script id="running" type="text/processing" data-processing-target="canvas"></script>
<canvas id="canvas" width="100" height="100"></canvas>

<div>
    <button id="reload">Draw</button>
    <div id="error"></div>
</div>

</body>
</html>
